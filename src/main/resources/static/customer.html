<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Solace Messages</title>
    <link rel="icon" href="http://localhost:8081/favicon.ico" type="image/x-icon">
    <script src="solclient.js"></script>
    <!-- Load the Persistence with Queues - Queue Consumer  -->
    <script src="QueueConsumer.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { color: #333; }
        .message { background-color: #f0f0f0; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .error { color: red; }
    </style>
</head>
<script>

    function fetchReservationDetails() {
        const button = document.getElementById("viewLink");
        const uniqueID = button.dataset.uniqueId; // Retrieve stored uniqueID
            
        fetch(`/customer/?uniqueID=${uniqueID}`)
                .then(response => response.json()) // Assuming the server returns JSON
                .then(data => {
                    if (data) {
                        window.location.href = `/customer-live-updates.html?uniqueID=${uniqueID}`;
                    } else {
                        alert("Error: Invalid response from server.");
                    }
                })
                .catch(error => {
                    console.error("Error fetching reservation details:", error);
                    alert("Failed to fetch reservation details.");
                });
        }

    var subscriber = null;
    window.onload = function () {
      // Initialize factory with the most recent API defaults
      var factoryProps = new solace.SolclientFactoryProperties();
      factoryProps.profile = solace.SolclientFactoryProfiles.version10_5;
      solace.SolclientFactory.init(factoryProps);

      // enable logging to JavaScript console at WARN level
      // NOTICE: works only with "solclientjs-debug.js"
      solace.SolclientFactory.setLogLevel(solace.LogLevel.WARN);

      // create the consumer, specifying name of the queue
      subscriber = new QueueConsumer('testQueue');
      // assign buttons to the subscriber functions
      document.getElementById("connect").addEventListener("click", subscriber.connect);
      document.getElementById("disconnect").addEventListener("click", subscriber.disconnect);
      document.getElementById("startconsume").addEventListener("click", subscriber.startConsume);
      document.getElementById("stopconsume").addEventListener("click", subscriber.stopConsume);
      document.getElementById("clear").addEventListener("click", subscriber.clear);
    };
    function iframeloaded(){
      if (subscriber) {
          subscriber.connectToSolace();
      }
    };
  </script>
<body>
    <h2>Live Messages f</h2>

    <!-- Message Section -->
    <h3>Updates</h3>
    <div id="messages"></div>

    <!-- Error message -->
    <div id="errorMessage" class="error" style="display: none;">
        <p>Could not recieve updates</p>
    </div>

    <script>
    </script>
</body>
</html>
